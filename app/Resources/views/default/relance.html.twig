{% extends 'base.html.twig' %}
{% block title %}Relance clients{% endblock %}
{% block header %}
    <h1>
        Clients relancés sans rendez-vous de suivi
    </h1>
{% endblock %}
{% block content %}
	{% embed ':Embed:box.html.twig' %}
        {% block title %}
            <i class="fa fa-plus"></i> Relance clients : <span id="nbclient"></span> client(s)
        {% endblock %}
        {% block boxContent %}
		<div class="">
			<div class="row">
				<div class="col-sm-12">
					<div class="col-sm-4" style="margin-left: -15px;">
						<label class="control-label">Depuis </label>
						<select name="mois" id="mois">
							{% for i in 1..12 %}
								<option value="{{i}}" {% if selected_mois != '' and i == selected_mois %}selected="selected"{% else %}{% if i == app.user.sincemonth %}selected="selected"{% endif %}{% endif %}> {{i}} </option>
							{% endfor %}
						</select>
						<label class="control-label"> mois</label>
					</div>
					<div class="col-sm-4">
						<label class="control-label">Conseiller</label>
						<select name="owner" id="owner">
							<option value=""></option>
							{% for owner in owners %}
								<option value="{{owner.id}}" {% if selected_owner != '' and owner.id == selected_owner %}selected="selected"{% endif %}>{{owner.forename}} {{owner.name}}</option>
							{% endfor %}
							<option value="S" > Supprimé(s) </option>
						</select>
					</div>
					<div class="col-sm-4">
						<button class="exportCSV pull-right" style="margin-right: -29px;">Export CSV</button>
					</div>
				</div>
			</div>
		</div>
		<br/>
    
	<table id="example" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
				<th>ThirdId</th>
                <th>Nom de la société</th>
                <th>Code client</th>
                <th>Adresse postale</th>
				<th>Adresse email</th>
				<th>Tel fixe</th>
				<th>Tel port</th>
				<th>Conseiller</th>
            </tr>
        </thead>
        
    </table>
	<div class="modal fade" id="bootstrap-modal" role="dialog">

		<div class="modal-dialog">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">×</button>
					<h4 class="modal-title">Informations du client</h4>
				</div>
				<div id="demo-modal"></div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default"
						data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	{% endblock %}
    {% endembed %}
{% endblock %}

{% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.18/af-2.3.3/b-1.5.6/b-colvis-1.5.6/b-flash-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/fc-3.2.5/fh-3.1.4/kt-2.5.0/r-2.2.2/rg-1.1.0/rr-1.2.4/sc-2.0.0/sl-1.3.0/datatables.min.css"/>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.18/af-2.3.3/b-1.5.6/b-colvis-1.5.6/b-flash-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/fc-3.2.5/fh-3.1.4/kt-2.5.0/r-2.2.2/rg-1.1.0/rr-1.2.4/sc-2.0.0/sl-1.3.0/datatables.min.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.4/js/dataTables.buttons.min.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.4/js/buttons.flash.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.4/js/buttons.html5.min.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.4/js/buttons.print.min.js"></script>
    <script >
	$(document).ready(function() {
		var table = $('#example').DataTable( {
					"responsive": true,
					"processing": true,
					"serverSide": true,
					"iDisplayLength": 100,
					"lengthMenu": [ [50, 100, 200], [50, 100, 200] ],
					/*
					"dom": 'Bfrtip',
					"buttons": [
						'copy', 'csv', 'excel', 'pdf', 'print'
					],
					*/
					"ajax": {
						"url": "{{ path('ind4') }}",
						"data": function ( d ) {
							d.mois =  $('#mois').children("option:selected").val();
							d.owner =  $('#owner').children("option:selected").val();
						}
						},
					language: {
									url: '//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/French.json'
								}
					}
					).on('xhr.dt', function ( e, settings, json, xhr ) {
						$('#nbclient').html(json.recordsTotal);
					} );
		
					
		$( "#mois" ).change(function() {
		  table.ajax.reload( function ( json ) {
				$('#nbclient').html(json.recordsTotal);
			} );
		});
		$( "#owner" ).change(function() {
		  table.ajax.reload( function ( json ) {
				$('#nbclient').html(json.recordsTotal);
			} );
		});
		$( ".exportCSV" ).on( "click", function() {
			var url = '{{ path("export", {'name': 'name'}) }}'; 
			url = url.replace("name", "relance");
			var data = table.ajax.params();
			url = url+"?"+$.param(data);
			window.open(url);
        
		});
	} );
	function loadDynamicContentModal(idClient) {
		var options = {
			modal : true,
			height : 300,
			width : 500
		};
		var url = '{{ path("view-client", {'id': 'client_id'}) }}'; 
		url = url.replace("client_id", idClient);
		$('#demo-modal').load(url,
				function() {
					$('#bootstrap-modal').modal({
						show : true
					});
				});
	}

	
	</script>
    
{% endblock %}